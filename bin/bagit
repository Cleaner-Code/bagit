#!/usr/bin/env ruby

require 'bagit'
require 'docopt'

doc = <<DOCOPT
BagIt.

Usage: 
  #{__FILE__} PATH [-f <file>...] [-t <tagfile>...]
  #{__FILE__} validate [-o | --oxum] PATH 
  #{__FILE__} -h | --version

Options:
  -h --help      Show this help screen.
  --version      Show version.
  -f <file>      File to add to bag. Repeatable.
  -t <tag_file>  Tag (metadata) file to add to bag. Repeatable.
  -o --oxum      Validate against oxum only (quick validate).

DOCOPT

begin
  opts = Docopt::docopt(doc, version: 'BagIt 0.3.0')
  
  bag = BagIt::Bag.new(opts['PATH'])

  # validation commands MUST NOT change manifest or bag-info files
  if opts['validate']
    if opts['--oxum']
      puts bag.valid_oxum?.to_s
      exit
    else
      puts bag.valid?.to_s
      exit
    end
  end

  unless opts['-f'].nil? 
    opts['-f'].each { |datafile|
      puts datafile
      #    bag.add_file(opts['-f'])
    }
  end
    
  unless opts['-t'].nil? 
    opts['-t'].each { |tagfile|
      puts tagfile
      #    bag.add_tag_file(opts['-t'])
      #    bag.tagmanifest!
    }
  end

  bag.manifest!

rescue Docopt::Exit => e
  puts e.message
end

